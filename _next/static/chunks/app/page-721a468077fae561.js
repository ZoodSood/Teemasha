(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2040:function(e,t,s){Promise.resolve().then(s.bind(s,3925))},3925:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return P}});var a=s(7437),r=s(2265),n=s(5905),i=s(3234);s(357);let o=(0,i.eI)("https://boqxelgcpajweyikibmp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvcXhlbGdjcGFqd2V5aWtpYm1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMDYyMTcsImV4cCI6MjA3OTU4MjIxN30.xjRY0dlS3TnEll-ZDIXmGr9eLMfgS3POcP_SEY4WiTk",{auth:{persistSession:!1,autoRefreshToken:!1},realtime:{params:{eventsPerSecond:10}}});class l{async createOrUpdateUser(e){let{data:t,error:s}=await o.from("users").upsert({telegram_user_id:e.id,first_name:e.first_name,last_name:e.last_name,telegram_username:e.username,is_premium:e.is_premium||!1},{onConflict:"telegram_user_id"});if(s)throw Error("Failed to create/update user: ".concat(s.message));return t?t[0]:null}async requestPairing(e){try{let{data:t}=await o.from("rooms").select("*").or("created_by.eq.".concat(e,",partner_user_id.eq.").concat(e)).eq("status","active").single();if(t)return{success:!1,message:"You are already in an active room"};let{data:s}=await o.from("rooms").select("*").eq("status","waiting").neq("created_by",e).order("created_at",{ascending:!0}).limit(1).single();if(s){let{error:t}=await o.from("rooms").update({partner_user_id:e,status:"active",updated_at:new Date().toISOString()}).eq("id",s.id);if(t)throw t;return await this.addRoomParticipants(s.id,[s.created_by,e]),{success:!0,room:{...s,partner_user_id:e}}}{let t=this.generateRoomCode(),{data:s,error:a}=await o.from("rooms").insert({room_code:t,status:"waiting",created_by:e}).select().single();if(a)throw a;return{success:!0,room:s}}}catch(e){return console.error("Pairing error:",e),{success:!1,message:"Failed to find or create room"}}}async getRoom(e){let{data:t,error:s}=await o.from("rooms").select("*").eq("id",e).single();return s?(console.error("Error fetching room:",s),null):t}async endRoom(e){let{error:t}=await o.from("rooms").update({status:"ended",updated_at:new Date().toISOString()}).eq("id",e);return!t||(console.error("Error ending room:",t),!1)}generateRoomCode(){return Math.random().toString(36).substring(2,8).toUpperCase()}async addRoomParticipants(e,t){let{data:s}=await o.from("users").select("id").in("telegram_user_id",t);if(s){let t=s.map(t=>({room_id:e,user_id:t.id}));await o.from("room_participants").insert(t)}}subscribeToRoom(e,t){return o.channel("room:".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"rooms",filter:"id=eq.".concat(e)},t).subscribe()}subscribeToRoomVideo(e,t){return o.channel("room_video:".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"room_videos",filter:"room_id=eq.".concat(e)},t).subscribe()}}let c=new l;var d=s(6319);let u={LOADING:"loading",AUTHENTICATING:"authenticating",WAITING:"waiting",ACTIVE:"active",ERROR:"error"};var m=s(3274);function x(e){let{message:t="Loading...",size:s="md",className:r=""}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4 ".concat(r),children:[(0,a.jsx)(m.Z,{className:"".concat({sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[s]," animate-spin text-tg-primary")}),(0,a.jsx)("p",{className:"text-sm text-tg-text-secondary text-center",children:t})]})}function p(e){let{message:t}=e;return(0,a.jsx)("div",{className:"min-h-screen bg-tg-bg flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4 p-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto bg-tg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.Z,{className:"w-8 h-8 animate-spin text-tg-primary"})}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-tg-text",children:"Teemasha"}),(0,a.jsx)("p",{className:"text-sm text-tg-text-secondary",children:t||"Initializing your experience..."})]})})}var h=s(8492),g=s.n(h),v=s(6780),f=s(4841),b=s(8094),y=s(3395),j=s(8733),w=s(8592),N=s(9590);function _(e){let[t,s]=(0,r.useState)(null),[a,n]=(0,r.useState)([]),[i,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(0),[x,p]=(0,r.useState)("connecting"),[h,g]=(0,r.useState)(null),v=(0,r.useRef)(null),f=(0,r.useRef)(null);(0,r.useRef)(null);let b=(0,r.useRef)([]),y=(0,r.useCallback)(()=>{[v.current,f.current,...b.current].filter(Boolean).forEach(e=>{try{o.removeChannel(e)}catch(e){console.warn("Error removing channel:",e)}}),b.current=[],v.current=null,f.current=null},[]);(0,r.useEffect)(()=>{if(!e)return;p("connecting"),y();let t=o.channel("room_video_".concat(e),{config:{broadcast:{self:!1,ack:!1},presence:{key:"video_sync_".concat(e)}}});t.on("postgres_changes",{event:"*",schema:"public",table:"room_videos",filter:"room_id=eq.".concat(e)},e=>{if(console.log("Video state update:",e),"UPDATE"===e.eventType&&e.new&&"object"==typeof e.new){let t=e.new;s({id:t.id,isPlaying:t.is_playing,currentTime:t.current_time,playbackRate:t.playback_rate,videoUrl:t.video_url,video_title:t.video_title,video_duration:t.video_duration,updatedAt:t.updated_at}),m(Date.now())}});let a=o.channel("room_participants_".concat(e),{config:{broadcast:{self:!0,ack:!1},presence:{key:"participants_".concat(e,"_").concat(Date.now())}}});return a.on("postgres_changes",{event:"*",schema:"public",table:"room_participants",filter:"room_id=eq.".concat(e)},e=>{console.log("Participant update:",e),w()}),Promise.all([t.subscribe((e,t)=>{console.log("Video channel status:",e,t),"SUBSCRIBED"===e?(l(!0),p("connected")):"CHANNEL_ERROR"===e||"TIMED_OUT"===e?(p("error"),l(!1)):"CLOSED"===e&&(p("disconnected"),l(!1))}),a.subscribe((e,t)=>{console.log("Participants channel status:",e,t)})]).then(()=>{Promise.all([j(),w(),N()]).catch(e=>{console.error("Initial data fetch error:",e),p("error")})}).catch(e=>{console.error("Channel subscription error:",e),p("error")}),v.current=t,f.current=a,b.current=[t,a],y},[e,y]);let j=async()=>{try{let{data:t,error:a}=await o.from("room_videos").select("*").eq("room_id",e).single();if(a){console.error("Failed to fetch video state:",a);return}t&&"object"==typeof t?s({isPlaying:t.is_playing,currentTime:t.current_time,playbackRate:t.playback_rate,videoUrl:t.video_url,video_duration:t.video_duration,updatedAt:t.updated_at}):s(null)}catch(e){console.error("Failed to fetch video state:",e)}},w=async()=>{if(e)try{let{data:i,error:l}=await o.from("room_participants").select("\n          *,\n          user:users(id, first_name, last_name, avatar_url)\n        ").eq("room_id",e).is("left_at",null).order("joined_at",{ascending:!0});if(l){console.error("Failed to fetch participants:",l);return}if(i){let o=i.map(t=>{var s,a,r;return{id:(null===(s=t.user)||void 0===s?void 0:s.id)||t.user_id,first_name:null===(a=t.user)||void 0===a?void 0:a.first_name,last_active:t.joined_at?new Date(t.joined_at).getTime():Date.now(),phx_ref:"user_".concat((null===(r=t.user)||void 0===r?void 0:r.id)||t.user_id,"_").concat(e)}});if(n(o),o.length>0&&!c){var t,s,a,r;let e=o[0],n=null===(a=window.Telegram)||void 0===a?void 0:null===(s=a.WebApp)||void 0===s?void 0:null===(t=s.initDataUnsafe)||void 0===t?void 0:t.user;(n&&e.id===(null===(r=n.id)||void 0===r?void 0:r.toString())||1===o.length)&&d(!0)}}}catch(e){console.error("Participant fetch error:",e)}},N=async()=>{try{let{data:t,error:s}=await o.from("rooms").select("*").eq("id",e).single();!s&&t&&g(t)}catch(e){console.error("Failed to fetch room details:",e)}},_=(0,r.useCallback)(async s=>{if(!c||!i){console.warn("Cannot sync video state: not leader or not connected");return}try{var a,r,n,l,d,u,x,p,h,g,f,b,y,j,w,N,_,S,T,A,k,C;let i={id:null==t?void 0:t.id,room_id:e,is_playing:null!==(r=null!==(a=s.isPlaying)&&void 0!==a?a:null==t?void 0:t.isPlaying)&&void 0!==r&&r,current_time:null!==(l=null!==(n=s.currentTime)&&void 0!==n?n:null==t?void 0:t.currentTime)&&void 0!==l?l:0,playback_rate:null!==(u=null!==(d=s.playbackRate)&&void 0!==d?d:null==t?void 0:t.playbackRate)&&void 0!==u?u:1,video_url:null!==(p=null!==(x=s.videoUrl)&&void 0!==x?x:null==t?void 0:t.videoUrl)&&void 0!==p?p:"",video_title:null!==(h=null==t?void 0:t.video_title)&&void 0!==h?h:null,video_duration:null!==(f=null!==(g=s.video_duration)&&void 0!==g?g:null==t?void 0:t.video_duration)&&void 0!==f?f:null,updated_at:new Date().toISOString()},c={id:null==t?void 0:t.id,room_id:e,is_playing:null!==(y=null!==(b=s.isPlaying)&&void 0!==b?b:null==t?void 0:t.isPlaying)&&void 0!==y&&y,current_time:null!==(w=null!==(j=s.currentTime)&&void 0!==j?j:null==t?void 0:t.currentTime)&&void 0!==w?w:0,playback_rate:null!==(_=null!==(N=s.playbackRate)&&void 0!==N?N:null==t?void 0:t.playbackRate)&&void 0!==_?_:1,video_url:null!==(T=null!==(S=s.videoUrl)&&void 0!==S?S:null==t?void 0:t.videoUrl)&&void 0!==T?T:"",video_title:null!==(A=null==t?void 0:t.video_title)&&void 0!==A?A:null,video_duration:null!==(C=null!==(k=s.video_duration)&&void 0!==k?k:null==t?void 0:t.video_duration)&&void 0!==C?C:null,updated_at:new Date().toISOString()},{error:I}=await o.from("room_videos").upsert(c,{onConflict:"room_id"});if(I)throw console.error("Failed to sync video state:",I),I;m(Date.now()),v.current&&v.current.send({type:"broadcast",event:"video_state_update",payload:i})}catch(e){throw console.error("Video state sync error:",e),e}},[e,t,c,i]),S=(0,r.useCallback)((e,t)=>{if(!v.current||!i){console.warn("Cannot send broadcast: channel not available");return}try{var s,a,r,n;v.current.send({type:"broadcast",event:e,payload:{...t,timestamp:Date.now(),sender:null===(n=window.Telegram)||void 0===n?void 0:null===(r=n.WebApp)||void 0===r?void 0:null===(a=r.initDataUnsafe)||void 0===a?void 0:null===(s=a.user)||void 0===s?void 0:s.id}})}catch(e){console.error("Broadcast send error:",e)}},[i]);return{currentState:t,participants:a,isConnected:i,isLeader:c,lastSyncTime:u,connectionStatus:x,syncVideoState:_,setLeader:(0,r.useCallback)(e=>{d(e)},[]),sendBroadcastMessage:S,roomDetails:h}}function S(e){let{roomId:t,videoUrl:s,onUrlChange:n,className:i=""}=e,[o,l]=(0,r.useState)(s||""),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(.8),[x,p]=(0,r.useState)(!1),[h,S]=(0,r.useState)(1),[T,A]=(0,r.useState)({played:0,playedSeconds:0,loaded:0,loadedSeconds:0}),[k,C]=(0,r.useState)(0),[I,R]=(0,r.useState)(!1),[E,P]=(0,r.useState)(""),[U,M]=(0,r.useState)(null),[L,D]=(0,r.useState)(!1),[O,B]=(0,r.useState)(!0),F=(0,r.useRef)(null),Z=(0,r.useRef)(),{syncVideoState:q,currentState:V,isLeader:W,isConnected:G,connectionStatus:Y,sendBroadcastMessage:z}=_(t);(0,r.useEffect)(()=>{if(V&&!I){let{isPlaying:e,currentTime:t,playbackRate:s,videoUrl:a}=V;a&&a!==o&&(l(a),null==n||n(a)),s!==h&&S(s),e!==c&&d(e),t&&Math.abs(t-T.playedSeconds)>2&&K(t)}},[V,I,T.playedSeconds,c,h,o]);let H=()=>{Z.current&&clearTimeout(Z.current),B(!0),Z.current=setTimeout(()=>{B(!1)},3e3)};(0,r.useEffect)(()=>(H(),()=>{Z.current&&clearTimeout(Z.current)}),[c,u,x,h]);let J=e=>{R(!0),K(e),q({isPlaying:c,currentTime:e,playbackRate:h,videoUrl:o}),setTimeout(()=>R(!1),100)},X=e=>{S(e),q({isPlaying:c,currentTime:T.playedSeconds,playbackRate:e,videoUrl:o})},Q=e=>{m(e),e>0&&p(!1)},K=e=>{var t;null===(t=F.current)||void 0===t||t.seekTo(e,"seconds")},$=e=>{if(/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)/.test(e)){var t;let s=null===(t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/))||void 0===t?void 0:t[1];return s?"https://www.youtube.com/watch?v=".concat(s):null}return/^(https?:\/\/)?(www\.)?(vimeo\.com\/|player\.vimeo\.com\/video\/)/.test(e)?e:null},ee=e=>{let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?"".concat(t,":").concat(s.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")):"".concat(s,":").concat(a.toString().padStart(2,"0"))};return o?(0,a.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden ".concat(i),onMouseMove:H,onMouseLeave:()=>B(!1),children:[(0,a.jsxs)("div",{className:"relative aspect-video bg-black",children:[(0,a.jsx)(g(),{ref:F,url:o,width:"100%",height:"100%",playing:c,volume:x?0:u,playbackRate:h,onProgress:e=>{A(e),W||I||q({isPlaying:c,currentTime:e.playedSeconds,playbackRate:h,videoUrl:o})},onDuration:C,onReady:()=>{D(!0),M(null)},onPlay:()=>d(!0),onPause:()=>d(!1),onError:e=>{console.error("Video player error:",e),M("Failed to load video. Please check the URL and try again.")},onEnded:()=>{d(!1),q({isPlaying:!1,currentTime:k,playbackRate:h,videoUrl:o})},config:{youtube:{playerVars:{modestbranding:1,rel:0,showinfo:0}},vimeo:{playerOptions:{dnt:!0}}}}),U&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)(v.Z,{className:"w-12 h-12 mx-auto mb-4 text-red-400"}),(0,a.jsx)("p",{className:"mb-4",children:U}),(0,a.jsx)("button",{onClick:()=>{M(null),o&&l(o)},className:"px-4 py-2 bg-tg-primary text-white rounded-lg hover:bg-tg-primary/90 transition-colors",children:"Try Again"})]})}),!L&&!U&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-tg-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{children:"Loading video..."})]})})]}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 transition-opacity duration-300 ".concat(O?"opacity-100":"opacity-0"),children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("input",{type:"range",min:0,max:k||0,value:T.playedSeconds,onChange:e=>J(parseFloat(e.target.value)),className:"w-full h-1 bg-tg-secondary-bg rounded-lg appearance-none cursor-pointer slider",style:{background:"linear-gradient(to right, var(--tg-primary) 0%, var(--tg-primary) ".concat(T.playedSeconds/k*100,"%, var(--tg-secondary-bg) ").concat(T.playedSeconds/k*100,"%, var(--tg-secondary-bg) 100%)")}}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-white mt-1",children:[(0,a.jsx)("span",{children:ee(T.playedSeconds)}),(0,a.jsx)("span",{children:ee(k)})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{if(I)return;let e=!c;d(e),q({isPlaying:e,currentTime:T.playedSeconds,playbackRate:h,videoUrl:o})},className:"w-10 h-10 bg-tg-primary rounded-full flex items-center justify-center text-white hover:bg-tg-primary/90 transition-colors",children:c?(0,a.jsx)(f.Z,{className:"w-5 h-5"}):(0,a.jsx)(b.Z,{className:"w-5 h-5 ml-0.5"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{p(!x)},className:"text-white hover:text-tg-primary transition-colors",children:x||0===u?(0,a.jsx)(y.Z,{className:"w-5 h-5"}):(0,a.jsx)(j.Z,{className:"w-5 h-5"})}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.1,value:u,onChange:e=>Q(parseFloat(e.target.value)),className:"w-16 h-1 bg-tg-secondary-bg rounded-lg appearance-none cursor-pointer slider"})]}),(0,a.jsxs)("div",{className:"text-white text-sm",children:[ee(T.playedSeconds)," / ",ee(k)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("select",{value:h,onChange:e=>X(parseFloat(e.target.value)),className:"bg-tg-secondary-bg text-white text-sm rounded px-2 py-1 border-none focus:ring-1 focus:ring-tg-primary",children:[(0,a.jsx)("option",{value:.5,children:"0.5x"}),(0,a.jsx)("option",{value:.75,children:"0.75x"}),(0,a.jsx)("option",{value:1,children:"1x"}),(0,a.jsx)("option",{value:1.25,children:"1.25x"}),(0,a.jsx)("option",{value:1.5,children:"1.5x"}),(0,a.jsx)("option",{value:2,children:"2x"})]}),(0,a.jsx)("button",{onClick:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},className:"text-white hover:text-tg-primary transition-colors",children:(0,a.jsx)(w.Z,{className:"w-5 h-5"})})]})]}),!G&&(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-2 text-yellow-400 text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"Reconnecting..."})]}),!W&&G&&(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-2 text-tg-primary text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-tg-primary rounded-full"}),(0,a.jsx)("span",{children:"Following host"})]})]}),o&&(0,a.jsx)("button",{onClick:()=>l(""),className:"absolute top-4 right-4 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center text-white hover:bg-black/70 transition-colors",title:"Change video",children:(0,a.jsx)(N.Z,{className:"w-4 h-4"})})]}):(0,a.jsxs)("div",{className:"bg-tg-secondary-bg rounded-lg p-6 ".concat(i),children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-tg-text mb-4",children:"Enter Video URL"}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!E.trim())return;let t=$(E.trim());t?(l(t),P(""),M(null),null==n||n(t),q({isPlaying:!1,currentTime:0,playbackRate:h,videoUrl:t})):M("Please enter a valid YouTube or Vimeo URL")},className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"url",value:E,onChange:e=>P(e.target.value),placeholder:"https://youtube.com/watch?v=... or https://vimeo.com/...",className:"w-full px-4 py-3 bg-tg-bg text-tg-text border border-tg-button-color rounded-lg focus:ring-2 focus:ring-tg-primary focus:border-transparent"})}),(0,a.jsx)("button",{type:"submit",disabled:!E.trim(),className:"w-full py-3 bg-tg-button-color text-tg-button-text font-medium rounded-lg hover:bg-tg-button-color/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Start Watching"})]}),U&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-400",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:U})]})}),(0,a.jsxs)("div",{className:"mt-6 text-sm text-tg-text-secondary",children:[(0,a.jsx)("p",{className:"mb-2",children:"Supported platforms:"}),(0,a.jsxs)("ul",{className:"space-y-1 text-xs",children:[(0,a.jsx)("li",{children:"• YouTube videos and playlists"}),(0,a.jsx)("li",{children:"• Vimeo videos"}),(0,a.jsx)("li",{children:"• Direct video file URLs (MP4, WebM, etc.)"})]})]})]})}var T=s(6160),A=s(5984),k=s(1240),C=s(957),I=s(933);function R(e){let{roomId:t,className:s=""}=e,{participants:r,currentState:n,isLeader:i,isConnected:o,connectionStatus:l,lastSyncTime:c,roomDetails:d}=_(t),u=e=>{let t=Math.max(0,Date.now()-e);return t<1e3?"just now":t<6e4?"".concat(Math.floor(t/1e3),"s ago"):t<36e5?"".concat(Math.floor(t/6e4),"m ago"):"".concat(Math.floor(t/36e5),"h ago")};return(0,a.jsxs)("div",{className:"bg-tg-secondary-bg rounded-lg p-4 ".concat(s),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:["connected"===l?(0,a.jsx)(T.Z,{className:"w-4 h-4 text-green-500"}):"connecting"===l?(0,a.jsx)("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-tg-primary border-t-transparent"}):(0,a.jsx)(A.Z,{className:"w-4 h-4 text-red-500"}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat("connected"===l?"text-green-500":"connecting"===l?"text-tg-primary":"text-red-500"),children:"connected"===l?"Connected":"connecting"===l?"Connecting...":"error"===l?"Connection Error":"Disconnected"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-tg-text-secondary",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{className:"text-sm",children:[r.length,"/2 watching"]})]})]}),(null==n?void 0:n.videoUrl)&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-tg-bg rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-tg-text truncate",children:new URL(n.videoUrl).hostname}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,a.jsx)("span",{className:"text-xs text-tg-text-secondary",children:n.isPlaying?"Playing":"Paused"}),(0,a.jsxs)("span",{className:"text-xs text-tg-text-secondary",children:[n.playbackRate,"x speed"]})]})]}),i&&(0,a.jsx)("div",{title:"You are the host",children:(0,a.jsx)(C.Z,{className:"w-4 h-4 text-tg-primary"})})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[(0,a.jsx)(I.Z,{className:"w-3 h-3 text-tg-text-secondary"}),(0,a.jsxs)("span",{className:"text-xs text-tg-text-secondary",children:["Last sync: ",c?u(c):"Never"]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-tg-text",children:"Participants"}),r.map((e,t)=>{var s,r;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-tg-bg rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-tg-primary/20 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-tg-primary",children:(null===(r=e.first_name)||void 0===r?void 0:null===(s=r[0])||void 0===s?void 0:s.toUpperCase())||"U"})}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-tg-text truncate",children:e.first_name||"Anonymous User"}),(0,a.jsx)("p",{className:"text-xs text-tg-text-secondary",children:0===t?"Host":"Viewer"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full animate-pulse ".concat(e.last_active>Date.now()-3e4?"bg-green-500":"bg-gray-500"),title:e.last_active>Date.now()-3e4?"Active":"Away"}),(0,a.jsx)("span",{className:"text-xs text-tg-text-secondary",children:u(e.last_active)})]})]},e.id)}),r.length<2&&(0,a.jsx)("div",{className:"text-center py-3 text-tg-text-secondary",children:(0,a.jsx)("p",{className:"text-sm",children:0===r.length?"Waiting for participants...":"Waiting for another user to join..."})})]}),d&&i&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-tg-button-color",children:(0,a.jsx)("button",{onClick:()=>{confirm("Are you sure you want to end this session?")&&console.log("Ending room:",t)},className:"w-full py-2 px-4 text-sm bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20 transition-colors",children:"End Session"})})]})}var E=s(6706);function P(){let{state:e,user:t,room:s,error:i,isLoading:o,requestPairing:l,endRoom:m,retry:h}=function(){let{user:e,isReady:t,error:s,webApp:a}=(0,n.f)(),[i,o]=(0,r.useState)({state:u.LOADING,user:null,room:null,error:null,isLoading:!1});(0,r.useEffect)(()=>{if(t){if(s){o(e=>({...e,state:u.ERROR,error:s,isLoading:!1}));return}e&&l()}},[t,s,e]);let l=async()=>{if(e)try{o(e=>({...e,state:u.AUTHENTICATING,isLoading:!0}));let t=await c.createOrUpdateUser(e);o(e=>({...e,user:t,state:u.WAITING,isLoading:!1})),d.p&&d.p.notificationOccurred("success")}catch(e){console.error("Failed to initialize user:",e),o(t=>({...t,state:u.ERROR,error:e instanceof Error?e.message:"Failed to initialize",isLoading:!1}))}},m=async()=>{if(e&&!i.isLoading)try{o(e=>({...e,isLoading:!0,error:null}));let t=await c.requestPairing(e.id);t.success&&t.room?(o(e=>({...e,room:t.room,state:u.ACTIVE,isLoading:!1})),d.p&&d.p.impactOccurred("medium")):o(e=>({...e,error:t.message||"Failed to find a partner",isLoading:!1}))}catch(e){console.error("Pairing request failed:",e),o(t=>({...t,error:e instanceof Error?e.message:"Pairing failed",isLoading:!1}))}},x=async()=>{if(i.room&&!i.isLoading)try{o(e=>({...e,isLoading:!0})),await c.endRoom(i.room.id)?(o(e=>({...e,room:null,state:u.WAITING,isLoading:!1})),d.p&&d.p.notificationOccurred("success")):o(e=>({...e,error:"Failed to end room",isLoading:!1}))}catch(e){console.error("Failed to end room:",e),o(t=>({...t,error:e instanceof Error?e.message:"Failed to end room",isLoading:!1}))}};return{...i,requestPairing:m,endRoom:x,retry:()=>{o(e=>({...e,error:null,isLoading:!1})),e&&l()}}}(),{webApp:g}=(0,n.f)();return((0,r.useEffect)(()=>{if(g)return e===u.WAITING?(g.MainButton.setText("Find Partner"),g.MainButton.onClick(l),g.MainButton.show()):e===u.ACTIVE?(g.MainButton.setText("End Session"),g.MainButton.onClick(m),g.MainButton.show()):g.MainButton.hide(),()=>{g.MainButton.offClick(()=>{})}},[e,g,l,m]),e===u.LOADING||e===u.AUTHENTICATING)?(0,a.jsx)(p,{message:e===u.LOADING?"Initializing your experience...":"Setting up your profile..."}):e===u.ERROR?(0,a.jsx)("div",{className:"min-h-screen bg-tg-bg flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full text-center space-y-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(v.Z,{className:"w-8 h-8 text-red-500"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-tg-text",children:"Something went wrong"}),(0,a.jsx)("p",{className:"text-sm text-tg-text-secondary",children:i||"An unexpected error occurred"})]}),(0,a.jsxs)("button",{onClick:h,disabled:o,className:"inline-flex items-center space-x-2 bg-tg-button text-tg-button-text px-6 py-3 rounded-lg font-medium hover:bg-tg-primary transition-colors disabled:opacity-50",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 ".concat(o?"animate-spin":"")}),(0,a.jsx)("span",{children:"Try Again"})]})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-tg-bg",children:[(0,a.jsx)("div",{className:"bg-white border-b border-tg-bg-secondary px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-tg-primary rounded-lg flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-tg-text",children:"Teemasha"}),(0,a.jsx)("p",{className:"text-xs text-tg-text-secondary",children:"Watch together"})]})]}),t&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-tg-text",children:t.first_name}),(0,a.jsx)("p",{className:"text-xs text-tg-text-secondary",children:t.telegram_username&&"@".concat(t.telegram_username)})]})]})}),(0,a.jsxs)("div",{className:"px-4 py-8",children:[e===u.WAITING?(0,a.jsx)(U,{onPair:l,isLoading:o}):(0,a.jsx)(M,{room:s,user:t}),i&&(0,a.jsx)("div",{className:"mt-6 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 text-red-500"}),(0,a.jsx)("p",{className:"text-sm text-red-700",children:i})]})})]}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50",children:(0,a.jsx)(x,{message:"Processing..."})})]})}function U(e){let{onPair:t,isLoading:s}=e;return(0,a.jsxs)("div",{className:"space-y-8 text-center",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"w-24 h-24 mx-auto bg-tg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)(k.Z,{className:"w-12 h-12 text-tg-primary"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-tg-text",children:"Ready to watch together?"}),(0,a.jsx)("p",{className:"text-tg-text-secondary",children:"Tap the button below to find someone to watch with"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:t,disabled:s,className:"w-full bg-tg-button text-tg-button-text py-4 rounded-lg font-semibold text-lg hover:bg-tg-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Finding partner...":"Find Partner"}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-1 text-sm text-tg-text-secondary",children:[(0,a.jsx)(I.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Average wait time: ~30 seconds"})]})]})]})}function M(e){let{room:t,user:s}=e,[n,i]=(0,r.useState)();return t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(k.Z,{className:"w-8 h-8 text-green-600"})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-tg-text mb-2",children:"You're connected!"}),(0,a.jsxs)("p",{className:"text-sm text-tg-text-secondary",children:["Room: ",(0,a.jsx)("span",{className:"font-mono font-medium",children:t.room_code})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(S,{roomId:t.id,videoUrl:n,onUrlChange:e=>{i(e)},className:"w-full"})}),(0,a.jsx)("div",{className:"lg:hidden",children:(0,a.jsx)(R,{roomId:t.id})}),(0,a.jsxs)("div",{className:"hidden lg:block grid grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2"}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)(R,{roomId:t.id})})]}),(0,a.jsx)("div",{className:"pt-4 border-t border-tg-button-color",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-tg-text-secondary",children:"Session Status"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-tg-text-secondary",children:"Your Name"}),(0,a.jsx)("p",{className:"font-medium text-tg-text",children:null==s?void 0:s.first_name})]})]})})]}):null}},5905:function(e,t,s){"use strict";s.d(t,{TelegramProvider:function(){return l},f:function(){return o}});var a=s(7437),r=s(2265),n=s(6319);let i=(0,r.createContext)({user:null,isReady:!1,error:null,webApp:null});function o(){let e=(0,r.useContext)(i);if(!e)throw Error("useTelegram must be used within a TelegramProvider");return e}function l(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[l,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null);return(0,r.useEffect)(()=>{try{if(!n.p)throw Error("Telegram Web App service not available");n.p.init(),x(n.p);let e=n.p.getUser();e?(o(e),c(!0)):u("User data not available")}catch(e){console.error("Failed to initialize Telegram Web App:",e),u(e instanceof Error?e.message:"Failed to initialize app")}},[]),(0,a.jsx)(i.Provider,{value:{user:s,isReady:l,error:d,webApp:m},children:t})}},6319:function(e,t,s){"use strict";s.d(t,{p:function(){return r}});class a{init(){this.webApp.expand(),this.webApp.ready(),this.webApp.setHeaderColor("#2cabff"),this.webApp.setBackgroundColor("#ffffff")}getUser(){var e;let t=null===(e=this.webApp.initDataUnsafe)||void 0===e?void 0:e.user;return t?{id:t.id,first_name:t.first_name,last_name:t.last_name,username:t.username,language_code:t.language_code,is_premium:t.is_premium,photo_url:void 0}:void 0}getInitData(){return this.webApp.initDataUnsafe}showAlert(e){this.webApp.showAlert(e)}showConfirm(e,t){this.webApp.showConfirm(e,t)}showMainButton(e,t,s){this.webApp.MainButton.setText(e),this.webApp.MainButton.setParams({text:e,color:s||"#2cabff",text_color:"#ffffff",is_visible:!0,is_active:!0}),this.webApp.MainButton.onClick(t),this.webApp.MainButton.show()}hideMainButton(){this.webApp.MainButton.hide()}close(){this.webApp.close()}impactOccurred(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light";this.webApp.HapticFeedback.impactOccurred(e)}notificationOccurred(e){this.webApp.HapticFeedback.notificationOccurred(e)}showBackButton(e){this.webApp.BackButton.show(),this.webApp.BackButton.onClick(e)}hideBackButton(){this.webApp.BackButton.hide()}getThemeParams(){return this.webApp.themeParams}onThemeChange(e){this.webApp.onEvent("themeChanged",e)}onViewportHeightChanged(e){this.webApp.onEvent("viewportChanged",e)}offViewportHeightChanged(e){this.webApp.offEvent("viewportChanged",e)}constructor(){var e;if(this.webApp=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp,!this.webApp)throw Error("Telegram Web App not available")}}let r=new a}},function(e){e.O(0,[60,971,23,744],function(){return e(e.s=2040)}),_N_E=e.O()}]);